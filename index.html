<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Dice Solver Pro - Multi-Solution</title>
    <style>
        :root {
            --bg: #121212;
            --card: #1e1e1e;
            --accent: #ff4757;
            --dice-white: #ffffff;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .container { background: var(--card); padding: 2rem; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); width: 100%; max-width: 550px; text-align: center; border: 1px solid #333; }
        
        .header h1 { margin: 0 0 1rem 0; font-size: 1.8rem; color: var(--accent); }
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 1rem; font-size: 0.9rem; color: #aaa; }
        .setting-item { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        
        select { background: #333; color: white; border: 1px solid #555; padding: 6px 12px; border-radius: 8px; cursor: pointer; width: 80%; }

        #input-area { 
            display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; 
            margin: 1.5rem 0; padding: 15px; min-height: 80px;
            border: 2px dashed #444; border-radius: 15px; background: rgba(255,255,255,0.02);
        }
        
        .dice-input {
            width: 50px; height: 50px; background-color: white !important; color: black !important;
            border-radius: 12px; font-size: 1.5rem; font-weight: bold; text-align: center;
            border: 2px solid #fff; box-shadow: 4px 4px 10px rgba(0,0,0,0.5); outline: none;
        }

        #target { 
            background: transparent; border: none; border-bottom: 3px solid var(--accent); 
            color: var(--accent); font-size: 2.5rem; width: 100px; text-align: center; 
            font-weight: bold; outline: none; margin-top: 5px;
        }

        .btn-solve {
            margin-top: 1.5rem; background: var(--accent); color: white; border: none; 
            padding: 15px; font-size: 1.2rem; font-weight: bold; border-radius: 50px; 
            cursor: pointer; transition: 0.3s; width: 100%;
        }
        .btn-solve:hover { background: #ff6b81; transform: scale(1.02); }

        #result { 
            margin-top: 1.5rem; padding: 1rem; border-radius: 15px; background: #252525;
            max-height: 300px; overflow-y: auto; text-align: left;
        }
        .solution-item { 
            padding: 10px; border-bottom: 1px solid #333; color: #2ed573; font-size: 1.1rem;
        }
        .solution-item:last-child { border-bottom: none; }
        .sol-raw { font-size: 0.7rem; color: #666; display: block; margin-bottom: 3px; font-family: monospace; }
        .no-sol { color: #ff4757; text-align: center; padding: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>üé≤ Dice Solver Pro</h1></div>

    <div class="settings-grid">
        <div class="setting-item">
            <span>È™∞Â≠êÊï∏Èáè (n)</span>
            <select id="n-select" onchange="generateInputs()">
                <option value="3">3</option><option value="4">4</option>
                <option value="5" selected>5</option><option value="6">6</option>
                <option value="7">7</option><option value="8">8</option>
            </select>
        </div>
        <div class="setting-item">
            <span>Ëß£Ê≥ïÈ°ØÁ§∫Êï∏Èáè</span>
            <select id="sol-count-select">
                <option value="1">ÂÉÖ 1 Á®Æ</option>
                <option value="3">ÊúÄÂ§ö 3 Á®Æ</option>
                <option value="5">ÊúÄÂ§ö 5 Á®Æ</option>
                <option value="999">ÂÖ®ÈÉ®È°ØÁ§∫</option>
            </select>
        </div>
    </div>

    <div id="input-area"></div>

    <div class="target-section">
        <p style="color:#888; margin: 0; font-size: 0.8rem;">TARGET X</p>
        <input type="number" id="target" value="24">
    </div>

    <button class="btn-solve" onclick="crack()">SOLVE NOW</button>

    <div id="result">Ê∫ñÂÇôÂ∞±Á∑í...</div>
</div>

<script>
    function generateInputs() {
        const n = document.getElementById('n-select').value;
        const area = document.getElementById('input-area');
        area.innerHTML = ''; 
        for (let i = 0; i < n; i++) {
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'dice-input';
            input.value = Math.floor(Math.random() * 6) + 1;
            area.appendChild(input);
        }
    }

    // ÂÖ®ÂüüËÆäÊï∏Â≠òÊîæÊâæÂà∞ÁöÑËß£
    let allSolutions = new Set();
    let maxSols = 1;

    function solveRecursive(items, target) {
        // Â¶ÇÊûúÂ∑≤Á∂ìÊâæÂ§†‰∫ÜÔºåÂ∞±ÂÅúÊ≠¢
        if (allSolutions.size >= maxSols) return;

        if (items.length === 1) {
            if (Math.abs(items[0].val - target) < 0.0001) {
                // ‰ΩøÁî® Set ÂÑ≤Â≠ò‰æÜÈÅøÂÖçÂÆåÂÖ®Áõ∏ÂêåÁöÑÁÆóÂºè
                allSolutions.add(items[0].expr);
            }
            return;
        }

        for (let i = 0; i < items.length; i++) {
            for (let j = 0; j < items.length; j++) {
                if (i === j) continue;
                const a = items[i], b = items[j], rem = items.filter((_, idx) => idx !== i && idx !== j);
                const ops = [{o:'+',v:a.val+b.val},{o:'-',v:a.val-b.val},{o:'*',v:a.val*b.val},{o:'/',v:b.val!==0?a.val/b.val:null}];
                for (let o of ops) {
                    if (o.v === null) continue;
                    solveRecursive([...rem, {val:o.v, expr:`(${a.expr}${o.o}${b.expr})`}], target);
                }
            }
        }
    }

    function cleanExpression(expr) {
        let res = expr;
        if (res.startsWith('(') && res.endsWith(')')) {
            let balance = 0; let isOuter = true;
            for (let i = 0; i < res.length
