<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Dice Solver Pro </title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --accent: #ff4757; --green: #2ed573; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .container { background: var(--card); padding: 2rem; border-radius: 30px; width: 100%; max-width: 500px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.6); border: 1px solid #333; }
        
        .settings { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .setting-item { display: flex; flex-direction: column; gap: 5px; color: #888; font-size: 0.85rem; }
        select { background: #2a2a2a; color: white; border: 1px solid #444; padding: 8px; border-radius: 10px; cursor: pointer; }

        #dice-area { 
            display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; 
            margin: 25px 0; padding: 20px; background: rgba(0,0,0,0.2); 
            border-radius: 20px; min-height: 140px; align-items: center;
        }
        .dice-wrap { width: 55px; height: 55px; display: none; }
        .dice-input {
            width: 100%; height: 100%; background: white !important; color: black !important;
            border-radius: 12px; font-size: 1.6rem; font-weight: bold; text-align: center;
            border: 3px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.3); outline: none;
        }

        #target { background: transparent; border: none; border-bottom: 4px solid var(--accent); color: var(--accent); font-size: 3rem; width: 120px; text-align: center; font-weight: bold; outline: none; margin-bottom: 25px; }
        
        button { width: 100%; padding: 18px; background: var(--accent); color: white; border: none; border-radius: 50px; font-size: 1.3rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.96); }

        #result-list { margin-top: 25px; background: #1a1a1a; border-radius: 20px; max-height: 250px; overflow-y: auto; text-align: left; border: 1px solid #333; }
        .sol-card { padding: 15px; border-bottom: 1px solid #2a2a2a; }
        .sol-clean { color: var(--green); font-size: 1.3rem; font-weight: 600; display: block; }
        .sol-path { color: #555; font-size: 0.7rem; font-family: monospace; display: block; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="color:var(--accent); margin:0 0 20px 0;">üé≤ Dice Solver Pro</h1>

    <div class="settings">
        <div class="setting-item"><span>Êï∏Èáè (Âº∑Âà∂ 1-6)</span><select id="n-select" onchange="refresh()"><option>3</option><option>4</option><option selected>5</option><option>6</option></select></div>
        <div class="setting-item"><span>È°ØÁ§∫‰∏äÈôê</span><select id="limit-select"><option value="5">5 Á®Æ</option><option value="999">‰∏çÈôê</option></select></div>
    </div>

    <div id="dice-area">
        <div class="dice-wrap" id="w0"><input type="number" class="dice-input" value="1" min="1" max="6"></div>
        <div class="dice-wrap" id="w1"><input type="number" class="dice-input" value="2" min="1" max="6"></div>
        <div class="dice-wrap" id="w2"><input type="number" class="dice-input" value="3" min="1" max="6"></div>
        <div class="dice-wrap" id="w3"><input type="number" class="dice-input" value="4" min="1" max="6"></div>
        <div class="dice-wrap" id="w4"><input type="number" class="dice-input" value="5" min="1" max="6"></div>
        <div class="dice-wrap" id="w5"><input type="number" class="dice-input" value="6" min="1" max="6"></div>
    </div>

    <input type="number" id="target" value="24">
    <button onclick="crack()">SOLVE NOW</button>
    <div id="result-list"><div style="color:#444; padding:20px; text-align:center;">Á≠âÂæÖËº∏ÂÖ•...</div></div>
</div>

<script>
    function refresh() {
        const n = parseInt(document.getElementById('n-select').value);
        for(let i=0; i<6; i++) document.getElementById('w'+i).style.display = (i < n) ? 'block' : 'none';
    }

    let found = new Map();
    let max;

    function normalize(expr) {
        return expr.replace(/\(|\)/g, '').split('').sort().join('');
    }

    function solve(items, target) {
        if (found.size >= max) return;
        if (items.length === 1) {
            // Ê•µÈôêÁ≤æÁ¢∫Â∫¶Ê†°Ê≠£Ôºö‰ΩøÁî® 1e-10 ÈÅøÂÖçÂÅΩÊ≠£Ëß£
            if (Math.abs(items[0].v - target) < 0.0000000001) {
                const norm = normalize(items[0].e);
                if (!found.has(norm)) found.set(norm, items[0].e);
            }
            return;
        }
        for (let i = 0; i < items.length; i++) {
            for (let j = 0; j < items.length; j++) {
                if (i === j) continue;
                const a = items[i], b = items[j], rem = items.filter((_, idx) => idx !== i && idx !== j);
                const ops = [
                    {o:'+', v:a.v+b.v}, {o:'*', v:a.v*b.v},
                    {o:'-', v:a.v-b.v}, {o:'/', v:Math.abs(b.v) > 0.0000000001 ? a.v/b.v : null}
                ];
                for (let o of ops) {
                    if (o.v !== null) solve([...rem, {v:o.v, e:`(${a.e}${o.o}${b.e})`}], target);
                }
            }
        }
    }

    function pretty(s) {
        if (s.startsWith('(') && s.endsWith(')')) {
            let b = 0, outer = true;
            for (let i = 0; i < s.length - 1; i++) {
                if (s[i] === '(') b++; if (s[i] === ')') b--;
                if (b === 0) { outer = false; break; }
            }
            if (outer) s = s.substring(1, s.length - 1);
        }
        return s.replace(/\*/g,' √ó ').replace(/\//g,' √∑ ').replace(/\+/g,' + ').replace(/\-/g,' - ');
    }

    function crack() {
        found.clear();
        const n = parseInt(document.getElementById('n-select').value);
        max = parseInt(document.getElementById('limit-select').value);
        const tar = parseFloat(document.getElementById('target').value);
        const nums = [];
        const inputs = document.querySelectorAll('.dice-input');
        
        for(let i=0; i<n; i++) {
            let v = parseInt(inputs[i].value);
            // Âº∑Âà∂‰øÆÊ≠£Âõû 1-6 ÁØÑÂúç
            if (isNaN(v) || v < 1) v = 1;
            if (v > 6) v = 6;
            inputs[i].value = v; 
            nums.push({v: v, e: v.toString()});
        }

        const resDiv = document.getElementById('result-list');
        resDiv.innerHTML = "<div style='color:#888; padding:20px; text-align:center;'>Ë®àÁÆó‰∏≠...</div>";
        
        setTimeout(() => {
            solve(nums, tar);
            resDiv.innerHTML = "";
            if (found.size > 0) {
                found.forEach((expr) => {
                    const card = document.createElement('div');
                    card.className = 'sol-card';
                    card.innerHTML = `<span class="sol-clean">${pretty(expr)} = ${tar}</span><span class="sol-path">${expr}</span>`;
                    resDiv.appendChild(card);
                });
            } else {
                resDiv.innerHTML = "<div style='color:#ff4757; padding:20px; text-align:center;'>ÁÑ°Ëß£</div>";
            }
        }, 50);
    }
    refresh();
</script>
</body>
</html>

