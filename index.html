<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Dice Solver - Ultimate Stable</title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --accent: #ff4757; --green: #2ed573; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .container { background: var(--card); padding: 2rem; border-radius: 30px; width: 100%; max-width: 500px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.6); border: 1px solid #333; }
        
        /* è¨­å®šå€ */
        .settings { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .setting-item { display: flex; flex-direction: column; gap: 5px; color: #888; font-size: 0.85rem; }
        select { background: #2a2a2a; color: white; border: 1px solid #444; padding: 8px; border-radius: 10px; cursor: pointer; }

        /* æ ¸å¿ƒï¼šéª°å­è¼¸å…¥å€ (çµ•å°ä¸æ¶ˆå¤±) */
        #input-area { 
            display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; 
            margin: 25px 0; padding: 20px; background: rgba(0,0,0,0.2); 
            border-radius: 20px; min-height: 130px; align-items: center;
        }
        .dice-wrap { width: 55px; height: 55px; } /* å›ºå®šå®¹å™¨å¤§å° */
        .dice-input {
            width: 100%; height: 100%; background: white !important; color: black !important;
            border-radius: 12px; font-size: 1.6rem; font-weight: bold; text-align: center;
            border: 3px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.3); outline: none;
        }

        /* ç›®æ¨™æ•¸ */
        .target-section { margin-bottom: 25px; }
        #target { 
            background: transparent; border: none; border-bottom: 4px solid var(--accent);
            color: var(--accent); font-size: 3rem; width: 100px; text-align: center; font-weight: bold; outline: none;
        }

        button {
            width: 100%; padding: 18px; background: var(--accent); color: white; border: none; 
            border-radius: 50px; font-size: 1.3rem; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        button:active { transform: scale(0.96); }

        /* è¼¸å‡ºå„ªåŒ– */
        #result-area { margin-top: 25px; background: #1a1a1a; border-radius: 20px; max-height: 250px; overflow-y: auto; text-align: left; border: 1px solid #333; }
        .sol-card { padding: 15px; border-bottom: 1px solid #2a2a2a; }
        .sol-clean { color: var(--green); font-size: 1.3rem; font-weight: 600; display: block; }
        .sol-path { color: #555; font-size: 0.7rem; font-family: monospace; display: block; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="color:var(--accent); margin:0 0 20px 0;">ğŸ² Dice Solver</h1>

    <div class="settings">
        <div class="setting-item"><span>éª°å­æ•¸é‡</span><select id="n-select" onchange="refreshView()"><option>3</option><option>4</option><option selected>5</option><option>6</option><option>7</option><option>8</option></select></div>
        <div class="setting-item"><span>è§£æ³•æ•¸é‡</span><select id="sol-limit"><option value="1">1 ç¨®</option><option value="5" selected>5 ç¨®</option><option value="999">å…¨éƒ¨</option></select></div>
    </div>

    <div id="input-area">
        <div class="dice-wrap" id="w-0"><input type="number" class="dice-input" value="1"></div>
        <div class="dice-wrap" id="w-1"><input type="number" class="dice-input" value="2"></div>
        <div class="dice-wrap" id="w-2"><input type="number" class="dice-input" value="3"></div>
        <div class="dice-wrap" id="w-3"><input type="number" class="dice-input" value="4"></div>
        <div class="dice-wrap" id="w-4"><input type="number" class="dice-input" value="5"></div>
        <div class="dice-wrap" id="w-5"><input type="number" class="dice-input" value="1"></div>
        <div class="dice-wrap" id="w-6"><input type="number" class="dice-input" value="2"></div>
        <div class="dice-wrap" id="w-7"><input type="number" class="dice-input" value="3"></div>
    </div>

    <div class="target-section">
        <input type="number" id="target" value="24">
    </div>

    <button onclick="crack()">SOLVE NOW</button>

    <div id="result-area"><div style="color:#444; padding:20px; text-align:center;">ç­‰å¾…è¨ˆç®—...</div></div>
</div>

<script>
    function refreshView() {
        const n = parseInt(document.getElementById('n-select').value);
        for(let i=0; i<8; i++) {
            document.getElementById('w-' + i).style.display = (i < n) ? 'block' : 'none';
        }
    }

    let results = new Set();
    let limit = 5;

    function solve(items, target) {
        if (results.size >= limit) return;
        if (items.length === 1) {
            if (Math.abs(items[0].v - target) < 0.001) results.add(items[0].e);
            return;
        }
        for (let i = 0; i < items.length; i++) {
            for (let j = 0; j < items.length; j++) {
                if (i === j) continue;
                const a = items[i], b = items[j], rem = items.filter((_, idx) => idx !== i && idx !== j);
                const ops = [{o:'+',v:a.v+b.v},{o:'-',v:a.v-b.v},{o:'*',v:a.v*b.v}];
                if(b.v !== 0) ops.push({o:'/',v:a.v/b.v});
                for (let o of ops) {
                    solve([...rem, {v:o.v, e:`(${a.e}${o.o}${b.e})`}], target);
                }
            }
        }
    }

    // å„ªåŒ–è¼¸å‡ºï¼šåªç§»é™¤æœ€å¤–å±¤æ‹¬è™Ÿèˆ‡æ›¿æ›ç¬¦è™Ÿ
    function pretty(expr) {
        let s = expr;
        if (s.startsWith('(') && s.endsWith(')')) {
            let b = 0, isO = true;
            for (let i = 0; i < s.length - 1; i++) {
                if (s[i] === '(') b++; if (s[i] === ')') b--;
                if (b === 0) { isO = false; break; }
            }
            if (isO) s = s.substring(1, s.length - 1);
        }
        return s.replace(/\*/g,' Ã— ').replace(/\//g,' Ã· ').replace(/\+/g,' + ').replace(/\-/g,' - ');
    }

    function crack() {
        results.clear();
        const n = parseInt(document.getElementById('n-select').value);
        limit = parseInt(document.getElementById('sol-limit').value);
        const target = parseFloat(document.getElementById('target').value);
        const nums = [];
        const inputs = document.querySelectorAll('.dice-input');
        
        for(let i=0; i<n; i++) {
            const v = parseFloat(inputs[i].value) || 0;
            nums.push({v: v, e: v.toString()});
        }

        const resArea = document.getElementById('result-area');
        resArea.innerHTML = "<div style='color:#888; padding:20px; text-align:center;'>è¨ˆç®—ä¸­...</div>";
        
        setTimeout(() => {
            solve(nums, target);
            resArea.innerHTML = "";
            if (results.size > 0) {
                results.forEach(r => {
                    const card = document.createElement('div');
                    card.className = 'sol-card';
                    card.innerHTML = `<span class="sol-clean">${pretty(r)} = ${target}</span><span class="sol-path">${r}</span>`;
                    resArea.appendChild(card);
                });
            } else {
                resArea.innerHTML = "<div style='color:#ff4757; padding:20px; text-align:center;'>ç„¡è§£</div>";
            }
        }, 50);
    }

    refreshView(); // åˆå§‹åŒ–
</script>
</body>
</html>
