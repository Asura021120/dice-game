<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>進階數學遊戲破解器 (n=1~8)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a2e; color: white; text-align: center; padding: 20px; }
        .box { background: #16213e; padding: 30px; border-radius: 20px; display: inline-block; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 90%; }
        .controls { margin-bottom: 20px; border-bottom: 1px solid #0f3460; padding-bottom: 20px; }
        select { padding: 8px; border-radius: 5px; background: #0f3460; color: white; border: none; font-size: 1rem; }
        #input-area { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin: 20px 0; }
        input { width: 60px; height: 50px; font-size: 1.3rem; text-align: center; border-radius: 8px; border: 2px solid #0f3460; background: #1a1a2e; color: #e94560; font-weight: bold; }
        #target { width: 100px; background: #e94560; color: white; border: none; }
        button { padding: 12px 40px; font-size: 1.1rem; cursor: pointer; background: #0f3460; color: white; border: 2px solid #e94560; border-radius: 50px; transition: all 0.3s; }
        button:hover { background: #e94560; transform: translateY(-2px); }
        #result { margin-top: 30px; font-size: 1.4rem; color: #4ecca3; word-break: break-all; min-height: 50px; line-height: 1.6; }
        .loading { color: #f1c40f; font-style: italic; }
    </style>
</head>
<body>

<div class="box">
    <div class="controls">
        <label>選取骰子數量 (n): </label>
        <select id="n-select" onchange="generateInputs()">
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5" selected>5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
        </select>
    </div>

    <div id="input-area">
        </div>

    <div>
        <p>目標數字 X</p>
        <input type="number" id="target" value="24">
    </div>
    
    <button onclick="crack()">立即尋找解法</button>
    <div id="result"></div>
</div>

<script>
    // 頁面載入時先生成一次輸入框
    window.onload = generateInputs;

    function generateInputs() {
        const n = parseInt(document.getElementById('n-select').value);
        const area = document.getElementById('input-area');
        area.innerHTML = '';
        for (let i = 0; i < n; i++) {
            const input = document.createElement('input');
            input.type = 'number';
            input.id = 'n' + i;
            input.value = Math.floor(Math.random() * 6) + 1;
            area.appendChild(input);
        }
    }

    async function crack() {
        const n = parseInt(document.getElementById('n-select').value);
        const target = parseFloat(document.getElementById('target').value);
        const display = document.getElementById('result');
        const nums = [];
        
        for (let i = 0; i < n; i++) {
            const val = parseFloat(document.getElementById('n'+i).value);
            if (!isNaN(val)) nums.push({ val: val, expr: val.toString() });
        }

        display.innerHTML = '<span class="loading">正在深度運算中... (n=' + n + ' 組合較多請稍候)</span>';

        // 使用 setTimeout 讓 UI 有時間顯示「計算中」
        setTimeout(() => {
            const startTime = Date.now();
            const solution = solve(nums, target);
            const endTime = Date.now();
            
            if (solution) {
                display.innerHTML = "找到解法了！<br><small style='color:#888'>(耗時 " + (endTime - startTime) + "ms)</small><br><br>" + solution;
            } else {
                display.innerText = "這組數字在嚴格規則下無解。";
            }
        }, 50);
    }

    function solve(items, target) {
        if (items.length === 1) {
            return Math.abs(items[0].val - target) < 0.0001 ? items[0].expr : null;
        }

        for (let i = 0; i < items.length; i++) {
            for (let j = 0; j < items.length; j++) {
                if (i === j) continue;

                const remaining = [];
                for (let k = 0; k < items.length; k++) {
                    if (k !== i && k !== j) remaining.push(items[k]);
                }
                
                const a = items[i], b = items[j];
                const ops = [
                    { val: a.val + b.val, expr: `(${a.expr}+${b.expr})` },
                    { val: a.val - b.val, expr: `(${a.expr}-${b.expr})` },
                    { val: a.val * b.val, expr: `(${a.expr}*${b.expr})` }
                ];
                if (Math.abs(b.val) > 0.000001) {
                    ops.push({ val: a.val / b.val, expr: `(${a.expr}/${b.expr})` });
                }

                for (let op of ops) {
                    const res = solve([...remaining, op], target);
                    if (res) return res;
                }
            }
        }
        return null;
    }
</script>

</body>
</html>
