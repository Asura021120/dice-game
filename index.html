<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Dice Solver Pro - Ultimate Stable</title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --accent: #ff4757; }
        body { font-family: sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: var(--card); padding: 2rem; border-radius: 24px; width: 90%; max-width: 500px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .header h1 { color: var(--accent); margin-bottom: 20px; }
        .settings { display: flex; justify-content: space-around; margin-bottom: 20px; }
        select { background: #333; color: white; border: 1px solid #555; padding: 5px; border-radius: 5px; }
        
        /* éª°å­æ’åˆ— */
        #dice-container { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin: 20px 0; min-height: 120px; align-items: center; }
        .dice-box { display: none; } /* é è¨­éš±è— */
        .dice-input {
            width: 50px; height: 50px; background: white; color: black;
            border-radius: 10px; font-size: 1.5rem; font-weight: bold; text-align: center;
            border: 2px solid #fff; box-shadow: 2px 2px 10px rgba(0,0,0,0.3); outline: none;
        }

        .target-section input {
            background: transparent; border: none; border-bottom: 3px solid var(--accent);
            color: var(--accent); font-size: 2rem; width: 80px; text-align: center; font-weight: bold;
        }
        button {
            margin-top: 20px; width: 100%; padding: 15px; background: var(--accent);
            color: white; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer;
        }
        #result { margin-top: 20px; padding: 15px; background: #252525; border-radius: 10px; text-align: left; max-height: 200px; overflow-y: auto; }
        .sol-item { padding: 8px; border-bottom: 1px solid #333; color: #2ed573; font-size: 1rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>ğŸ² Dice Solver Pro</h1></div>

    <div class="settings">
        <div>æ•¸é‡: <select id="n-select" onchange="updateView()"><option>3</option><option>4</option><option selected>5</option><option>6</option><option>7</option><option>8</option></select></div>
        <div>è§£æ³•: <select id="sol-limit"><option value="1">1ç¨®</option><option value="3" selected>3ç¨®</option><option value="5">5ç¨®</option><option value="999">å…¨éƒ¨</option></select></div>
    </div>

    <div id="dice-container">
        <div class="dice-box" id="db-0"><input type="number" class="dice-input" value="1"></div>
        <div class="dice-box" id="db-1"><input type="number" class="dice-input" value="2"></div>
        <div class="dice-box" id="db-2"><input type="number" class="dice-input" value="3"></div>
        <div class="dice-box" id="db-3"><input type="number" class="dice-input" value="4"></div>
        <div class="dice-box" id="db-4"><input type="number" class="dice-input" value="5"></div>
        <div class="dice-box" id="db-5"><input type="number" class="dice-input" value="6"></div>
        <div class="dice-box" id="db-6"><input type="number" class="dice-input" value="1"></div>
        <div class="dice-box" id="db-7"><input type="number" class="dice-input" value="2"></div>
    </div>

    <div class="target-section">
        <p style="color:#888; margin:0;">TARGET X</p>
        <input type="number" id="target" value="24">
    </div>

    <button onclick="crack()">SOLVE NOW</button>

    <div id="result">çµæœé¡¯ç¤ºå€</div>
</div>

<script>
    // æ§åˆ¶é¡¯ç¤ºå¹¾å€‹éª°å­
    function updateView() {
        const n = parseInt(document.getElementById('n-select').value);
        for(let i=0; i<8; i++) {
            document.getElementById('db-' + i).style.display = (i < n) ? 'block' : 'none';
        }
    }

    let solutions = new Set();
    let limit = 1;

    function solve(items, target) {
        if (solutions.size >= limit) return;
        if (items.length === 1) {
            if (Math.abs(items[0].v - target) < 0.001) solutions.add(items[0].e);
            return;
        }
        for (let i = 0; i < items.length; i++) {
            for (let j = 0; j < items.length; j++) {
                if (i === j) continue;
                const a = items[i], b = items[j], rem = items.filter((_, idx) => idx !== i && idx !== j);
                const ops = [{o:'+',v:a.v+b.v},{o:'-',v:a.v-b.v},{o:'*',v:a.v*b.v}];
                if(b.v !== 0) ops.push({o:'/',v:a.v/b.v});
                for (let o of ops) {
                    solve([...rem, {v:o.v, e:`(${a.e}${o.o}${b.e})`}], target);
                }
            }
        }
    }

    function crack() {
        solutions.clear();
        limit = parseInt(document.getElementById('sol-limit').value);
        const n = parseInt(document.getElementById('n-select').value);
        const target = parseFloat(document.getElementById('target').value);
        const nums = [];
        
        // åªæŠ“å–ç›®å‰ã€Œé¡¯ç¤ºä¸­ã€çš„ input
        for(let i=0; i<n; i++) {
            const val = parseFloat(document.querySelectorAll('.dice-input')[i].value);
            nums.push({v: val, e: val.toString()});
        }

        document.getElementById('result').innerHTML = "è¨ˆç®—ä¸­...";
        
        setTimeout(() => {
            solve(nums, target);
            if (solutions.size > 0) {
                let html = "";
                solutions.forEach(s => {
                    let clean = s.replace(/\*/g,'Ã—').replace(/\//g,'Ã·');
                    html += `<div class="sol-item">${clean} = ${target}</div>`;
                });
                document.getElementById('result').innerHTML = html;
            } else {
                document.getElementById('result').innerHTML = "ç„¡è§£";
            }
        }, 50);
    }

    // åˆå§‹åŒ–
    updateView();
</script>
</body>
</html>
